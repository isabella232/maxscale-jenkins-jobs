- job:
    name: upgrade_test_all
    description: 'View: upgrade_test. This job executes upgrade test'
    project-type: matrix
    execution-strategy:
      sequential: false
    axes:
      - axis:
          type: user-defined
          name: box
          values:
            !include: './maxscale_jobs/include/boxes.yaml'
    parameters:
        - !include: './maxscale_jobs/include/do_not_destroy_vm.yaml'
        - !include: './maxscale_jobs/include/old_target.yaml'
        - !include: './maxscale_jobs/include/new_target.yaml'
        - !include: './maxscale_jobs/include/ci_url.yaml'
        - !include: './maxscale_jobs/include/slave.yaml'
    properties:
      - throttle:
          matrix-configs: true
          matrix-builds: false
          option: category
          categories:
            - cat1
          enabled: true
    builders:
        - shell: |
            if [ ! -d ./BUILD ] ; then
              cp -r $HOME/maxscale-jenkins-jobs/maxscale-scripts/BUILD .
            fi
            if [ ! -d ./BUILD/mdbci ] ; then
              cp -r $HOME/maxscale-jenkins-jobs/maxscale-scripts/BUILD/mdbci BUILD/
            fi
            ./BUILD/mdbci/upgrade_test.sh
    wrappers:
      - !include: './maxscale_jobs/include/workspace-cleanup.yaml'
    concurrent: true

