- job:
    name: install_plugins
    description: 'This job install plugins like on max-tst-01 on other jenkins instances'
    parameters:
      - !include: './maxscale_jobs/include/jenkins_configuration/host.yaml'
      - !include: './maxscale_jobs/include/jenkins_configuration/port.yaml'
    builders:
      - shell: | 
          java -jar $HOME/jenkins-cli.jar -s http://max-tst-01.mariadb.com:8089/ list-plugins > $WORKSPACE/jenkins-plugins.temp
          sed -i 's|(.*)||g' jenkins-plugins.temp
          awk -F' ' '{print $1 " " $NF}' jenkins-plugins.temp > $WORKSPACE/jenkins-plugins
          $HOME/mdbci/scripts/jenkins_cli/install_plugins.sh -s $host -p $port -f $WORKSPACE/jenkins-plugins
    publishers:
      - workspace-cleanup

